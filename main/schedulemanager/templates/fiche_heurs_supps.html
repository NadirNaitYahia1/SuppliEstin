<div class="flex items-center mb-3 mt-10 ms-2  changeType">
    <p>Enseignant</p>
    <button class="btn1 bg-blue-950 rounded-md p-2 text-white mx-2">
        Permanant
    </button>
    <button class="btn2 bg-blue-300 rounded-md p-2 text-white mx-2">
        Vacataire
    </button>
</div> 

{% extends 'header.html' %}
{% block title %}{% endblock %}

{% block content %}
<body class="mx-auto w-[90%] border mb-10">


    <div class='flex items-center mt-3'>
        <p class=' w-[20%]'>Ref N:
            <input  placeholder='  ....... ' class='w-[20%] border text-center' ></input> ESTIN/2023
        </p>

        <div class="items-center icons">   
            <button class='ms-2'  >
                <i class="fa-solid fa-pen"></i>                    
            </button>
          
            <button class='ms-2' >
                <i class="fa-solid fa-floppy-disk"></i>
            </button>
       
        </div>
    </div>
       
    <div class='mt-3'>
        <p class="text-center">
            Etat de service des heures complementaires <br/> Enseignants {% if type == 'permanant' %} Permanants {% else %} Vacataires {% endif %}  
        </p>
    </div>

    <div class='flex items-center justify-between mx-4 mb-2 '>
        <form method="GET" >
            <div class='flex items-center'>
                <select name="selected_year" class="border-none yearclass" >
                    {% for annee, mois in anneeUnniv %}
                        <option value="{{ annee }}">{{ annee }}</option>
                    {% endfor %}
                </select>
                <select name="selected_month" class="border-none monthclass">
                    {% for annee, mois in anneeUnniv %}
                        {% for m in mois %}
                            <option value="{{ m }}-{{ annee }}" >{{ m }}-{{ annee }}</option>
                        {% endfor %}
                    {% endfor %}
                </select>
            </div>
        </form>

    
        <div class='icons '>
            
            
            <button  class="font-semibold text-gray-700 rounded-lg text-lg hover:text-blue-600 relative modifier-button"  name="modifier"   >
                <i class="fa-solid fa-pen"></i>
            </button>
            
            <button name="save">
                <i class="fa-solid fa-floppy-disk"></i>
            </button>

            <button class='mx-2' name="print" > 
                <i class="fa-solid fa-print"></i>                    
            </button>                    
                    
            <button  name="download"> 
                <i class="fa-solid fa-download"></i>                    
            </button>                    
        </div>

    </div>

    
    
    <style>
        @media print {
            .icons {
                display: none;
            }
            
            body{
                margin-top: 30px !important;
          

            }
            .yearclass{
                display: none;
            }
            .monthclass{
                font-weight: bold;
            }
            select::-ms-expand {
        display: none;
    }
    select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        /* Utiliser une image transparente pour masquer la flèche de sélection */
        background-image: url('../static/transparent.png');
        background-repeat: no-repeat;
        background-position: right center;
        /* Ajuster la largeur de l'arrière-plan pour couvrir la flèche de sélection */
        padding-right: 20px; /* Ajustez la valeur selon vos besoins */
    }

    title {
        display: none;
    }
       
    .changeType{
        display: none;
    }


        }
    </style>


    <div id="table-container" class="table-container  mb-8">
        <table class="w-full border mx-auto " id="teacher-table">
            <thead class='text-col-3 '>
                <tr>
                    <th>N°</th>
                    <th>Nom & prénom</th>
                    <th>Grade</th>
                    <th>Module Enseigné</th>
                    <th>Volume horaire autorisé</th>
                    <th>Nombre de semaines</th>
                    <th>Nombre d'heures Mensuelles</th>
                </tr>
            </thead>
        
            <tbody>
                {% for item in list %}
                    <tr class="modefiable">
                        <td class="text-center">{{ item.id }}</td>  
                        <td class="text-center">{{ item.nom }} {{ item.prenom }}</td>
                        <td class="text-center">{{ item.grade }}</td>
                        <td class="text-center">{{ item.module_enseigne }}</td>
                        <td class="text-center">{{ item.volumeAutorise }}</td>
                        <td class="text-center">{{ item.nbSemaine }}</td>
                        <td class="text-center toModify">{{ item.nbHeursSupp }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


    <style>
        .scrollable-table {
        max-height: 90%;  
        overflow-y: auto;  
        }
 
    </style>

    <div class="mt-8 pb-36 cachet">
        <div class="flex items-center justify-around">
            <div >
                <p class="text-sm ms-5">Reçu le <span class="font-semibold">................</span></p>
            </div>
            
            <div  >
                <p class="font-semibold mr-5">Avis du chef de département</p>
            </div>
        </div>
    </div>

    <style>
        .noDisplay{
            display: none;

        }
    </style>

    <script>

// Changer la couleur du bouton actif: 
    const button1 = document.querySelector(".btn1");
    const button2 = document.querySelector(".btn2");

    function changeColor(numButton) {
        let type;
        if (numButton === 1) {
            type = "permanant";
            button1.classList.remove('bg-blue-300');
            button1.classList.add('bg-blue-950');
            button2.classList.remove('bg-blue-950');
            button2.classList.add('bg-blue-300');
        } else {
            type = "vaccataire";
            button2.classList.remove('bg-blue-300');
            button2.classList.add('bg-blue-950');
            button1.classList.remove('bg-blue-950');
            button1.classList.add('bg-blue-300');
        }

        const url = `/fiche-heurs-supps/${type}/<str:year>/<str:month>/`;

        window.location.href = url;
    }

    button1.addEventListener("click", function() {
        changeColor(1);
    });
    button2.addEventListener("click", function() {
        changeColor(2);
    });

// Ajouter la classe 'scrollable-table' si le tableau contient plus de 12 lignes
    document.addEventListener("DOMContentLoaded", function() {
        const teacherTable = document.getElementById("teacher-table");
        const tableContainer = document.getElementById("table-container");

        if (teacherTable.rows.length > 12) {
            tableContainer.classList.add("scrollable-table");
        }
    });


// Filtrer les options de mois en fonction de l'année sélectionnée
    const selectYear = document.querySelector('select[name="selected_year"]');
    const selectMonth = document.querySelector('select[name="selected_month"]');


    selectYear.addEventListener('change', function() {
        const selectedYear = selectYear.value;


        for (let i = 0; i < selectMonth.options.length; i++) {
            const option = selectMonth.options[i];
            const [month, year] = option.value.split('-');

        
            if (year === selectedYear) {
                option.style.display = 'block'; 
            } else {
                option.style.display = 'none';  
            }
        }
        if (selectedYear === "{{ year }}") {
            selectMonth.value = "{{ month }}-{{ year }}";
        } else {
            selectMonth.value = '';
        }
    });
    selectMonth.addEventListener('change', function() {
        const selectedYear = selectYear.value;
        const selectedMonth = selectMonth.value.split('-')[0];
        console.log(selectedYear, selectedMonth)
        const url = `/fiche-heurs-supps/{{ type }}/${selectedYear}/${selectedMonth}/`;
        window.location.href = url;
    });

    selectYear.value = "{{ year }}";
    selectMonth.value = "{{ month }}-{{ year }}";

    selectYear.dispatchEvent(new Event('change'));





// Fonctionnalité d'impression et de téléchargement 
    document.addEventListener("DOMContentLoaded", function() {
        const printButton = document.querySelector('button[name="print"]');

        printButton.addEventListener('click', function() {

            const tableContainer = document.getElementById("table-container");
            const teacherTable = document.getElementById("teacher-table");
            tableContainer.classList.remove("scrollable-table");
            teacherTable.classList.remove("table-container");

            print();
            setTimeout(function() {
                tableContainer.classList.add("scrollable-table");
                teacherTable.classList.add("table-container");
            }, 500);  
        });

    });
// fonctionnalité de modification :
const modifierButton = document.querySelector('.modifier-button');
const saveButton = document.querySelector('button[name="save"]');

modifierButton.addEventListener('click', function() {
    const modefiableCells = document.querySelectorAll('.toModify');
    modifierButton.classList.add('noDisplay');
    saveButton.classList.remove('noDisplay');

    modefiableCells.forEach(function(cell) {
        const input = document.createElement('input');
        input.type = 'text';
        input.value = cell.textContent.trim();
        cell.appendChild(input);
    });
});

saveButton.addEventListener('click', function() {
    const modefiableCells = document.querySelectorAll('.toModify');
    const data = [];
    modefiableCells.forEach(function(cell) {
        const input = cell.querySelector('input');
        let edited = 0;
        if (input.value !== cell.textContent.trim()) {
            edited = 1;  
        }
        data.push({'id': cell.parentElement.children[0].textContent, 'nbHeursSupp': input.value, 'edited': edited});
        cell.textContent = input.value; 
    });

    saveButton.classList.add('noDisplay');
    modifierButton.classList.remove('noDisplay');
    fetch('/fiche-heurs-supps/save/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({ data: data }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('Les données ont été sauvegardées avec succès.');
        } else {
            console.error('La sauvegarde des données a échoué.');
        }
    })
    .catch(error => {
        console.error('Une erreur s\'est produite lors de la sauvegarde des données:', error);
    });
});

 




    


</script>


</body>

{% endblock %}
