<div class="flex items-center mb-3 mt-10 ms-2  changeType">
    <p>Enseignant</p>
    <button class="btn1 bg-blue-950 rounded-md p-2 text-white mx-2">
        Permanant
    </button>
    <button class="btn2 bg-blue-300 rounded-md p-2 text-white mx-2">
        Vacataire
    </button>
</div> 

{% extends 'header.html' %}
{% block title %}{% endblock %}

{% block content %}
<body class="mx-auto w-[90%] border mb-10">

    <div class='flex items-center mt-3'>
        <p class=' w-[20%]'>Ref N:
            <input  placeholder='  ....... ' class='w-[20%] border text-center' ></input> ESTIN/2023
        </p>

        <div class="items-center icons">   
            <button class='ms-2'  >
                <i class="fa-solid fa-pen"></i>                    
            </button>
          
            <button class='ms-2' >
                <i class="fa-solid fa-floppy-disk"></i>
            </button>
       
        </div>
    </div>
       
    <div class='mt-3'>
        <p class="text-center">
            Etat de service des heures complementaires <br/> Enseignants {% if type == 'permanant' %} Permanants {% else %} Vacataires {% endif %}  
        </p>
    </div>

    <div class='flex items-center justify-between mx-4 mb-2 '>
        <form method="GET" >
            <div class='flex items-center'>
                <select name="selected_year" class="border-none yearclass" >
                    {% for annee, mois in anneeUnniv %}
                        <option value="{{ annee }}">{{ annee }}</option>
                    {% endfor %}
                </select>
                <select name="selected_month" class="border-none monthclass">
                    {% for annee, mois in anneeUnniv %}
                        {% for m in mois %}
                            <option value="{{ m }}-{{ annee }}" >{{ m }}-{{ annee }}</option>
                        {% endfor %}
                    {% endfor %}
                </select>
            </div>
        </form>

    
        <div class='icons '>
            <button  class="font-semibold text-gray-700 rounded-lg text-lg hover:text-blue-600 relative modifier-button"  name="modifier"   >
                <i class="fa-solid fa-pen"></i>
            </button>
            
            <button>
                <i class="fa-solid fa-floppy-disk"></i>
            </button>

            <button class='mx-2' name="print" > 
                <i class="fa-solid fa-print"></i>                    
            </button>                    
                    
            <button  name="download"> 
                <i class="fa-solid fa-download"></i>                    
            </button>                    
        </div>

    </div>

    <style>
        @media print {
            .icons {
                display: none;
            }
            
            body{
                margin-top: 30px !important;
          

            }
            .yearclass{
                display: none;
            }
            .monthclass{
                font-weight: bold;
            }
            select::-ms-expand {
        display: none;
    }
    select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        /* Utiliser une image transparente pour masquer la flèche de sélection */
        background-image: url('../static/transparent.png');
        background-repeat: no-repeat;
        background-position: right center;
        /* Ajuster la largeur de l'arrière-plan pour couvrir la flèche de sélection */
        padding-right: 20px; /* Ajustez la valeur selon vos besoins */
    }

    title {
        display: none;
    }
       
    .changeType{
        display: none;
    }
        }
    </style>

    <div id="table-container" class="table-container  mb-8">
        <table class="w-full border mx-auto " id="teacher-table">
            <thead class='text-col-3 '>
                <tr>
                    <th>N°</th>
                    <th>Nom & prénom</th>
                    <th>Grade</th>
                    <th>Module Enseigné</th>
                    <th>Volume horaire autorisé</th>
                    <th>Nombre de semaines</th>
                    <th>Nombre d'heures Mensuelles</th>
                </tr>
            </thead>
        
            <tbody>
                {% for item in list %}
                    <tr class="modefiable">
                        <td class="text-center">{{ item.id }}</td>  
                        <td class="text-center">{{ item.nom }} {{ item.prenom }}</td>
                        <td class="text-center">{{ item.grade }}</td>
                        <td class="text-center">{{ item.module_enseigne }}</td>
                        <td class="text-center">{{ item.volumeAutorise }}</td>
                        <td class="text-center">{{ item.nbSemaine }}</td>
                        <td class="text-center toModify" data-column-name="nbHeursSupp">{{ item.nbHeursSupp }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


    <style>
        .scrollable-table {
        max-height: 90%;  
        overflow-y: auto;  
        }
    </style>

    <div class="mt-8 pb-36 cachet">
        <div class="flex items-center justify-around">
            <div >
                <p class="text-sm ms-5">Reçu le <span class="font-semibold">................</span></p>
            </div>
            
            <div  >
                <p class="font-semibold mr-5">Avis du chef de département</p>
            </div>
        </div>
    </div>


    <script>
    // Changer la couleur du bouton actif: 
    const button1 = document.querySelector(".btn1");
    const button2 = document.querySelector(".btn2");

    function changeColor(numButton) {
        let type;
        if (numButton === 1) {
            type = "permanant";
            button1.classList.remove('bg-blue-300');
            button1.classList.add('bg-blue-950');
            button2.classList.remove('bg-blue-950');
            button2.classList.add('bg-blue-300');
        } else {
            type = "vaccataire";
            button2.classList.remove('bg-blue-300');
            button2.classList.add('bg-blue-950');
            button1.classList.remove('bg-blue-950');
            button1.classList.add('bg-blue-300');
        }

        const url = `/fiche-heurs-supps/${type}/<str:year>/<str:month>/`;

        window.location.href = url;
    }

    button1.addEventListener("click", function() {
        changeColor(1);
    });
    button2.addEventListener("click", function() {
        changeColor(2);
    });

    // Ajouter la classe 'scrollable-table' si le tableau contient plus de 12 lignes
    document.addEventListener("DOMContentLoaded", function() {
        const teacherTable = document.getElementById("teacher-table");
        const tableContainer = document.getElementById("table-container");

        if (teacherTable.rows.length > 12) {
            tableContainer.classList.add("scrollable-table");
        }
    });

    // Fonctionnalité de modification :
    document.addEventListener("DOMContentLoaded", function() {
        const modifierButton = document.querySelector('.modifier-button');

        modifierButton.addEventListener('click', function() {
            const modefiableCells = document.querySelectorAll('.toModify');

            modefiableCells.forEach(function(cell) {
                const input = document.createElement('input');
                input.type = 'text';
                input.value = cell.textContent.trim();  
                cell.textContent = '';
                cell.appendChild(input);
            });
        });
    });

    // Fonctionnalité de sauvegarde des modifications
    document.addEventListener("DOMContentLoaded", function() {
    const saveButton = document.querySelector('button[name="save"]');
    saveButton.addEventListener('click', function() {
        const modifiedRows = document.querySelectorAll('.modefiable');
        const data = []; // Tableau pour stocker les données modifiées

        modifiedRows.forEach(function(row) {
            const inputs = row.querySelectorAll('input[type="text"]');
            const rowData = {}; // Objet pour stocker les données de chaque ligne modifiée
            
            inputs.forEach(function(input) {
                const columnName = input.parentElement.getAttribute('data-column-name');
                const columnValue = input.value;
                rowData[columnName] = columnValue; // Stocker la valeur dans l'objet rowData sous forme de paire clé-valeur
            });

            data.push(rowData); // Ajouter l'objet rowData au tableau de données
        });

        // Envoyer les données modifiées au serveur pour sauvegarde dans la base de données
        // Vous pouvez utiliser AJAX (par exemple, XMLHttpRequest ou fetch) pour cela
        // Ici, j'imprime simplement les données modifiées dans la console pour démonstration
        console.log(data);
    });
    });

    </script>
</body>
{% endblock %}
